<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Oregon Trail – Multiplayer</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    #voteBtns button { margin: 0 .5em; padding: .5em 1em; }
    #roundResult { margin-top: 1em; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Oregon Trail – Multiplayer</h1>
  <div id="status">
    <p>Day: <span id="day">1</span></p>
    <p>Health: <span id="health">100</span></p>
    <p>Food: <span id="food">100</span> lbs</p>
  </div>

  <div id="voteBtns">
    <button id="restBtn" disabled>Vote “Rest”</button>
    <button id="huntBtn" disabled>Vote “Hunt”</button>
  </div>

  <p id="roundResult"></p>

  <script>
    //–– 1) Game state
    const state = { day:1, health:100, food:100 };
    function updateStatusUI() {
      document.getElementById('day').textContent    = state.day;
      document.getElementById('health').textContent = state.health;
      document.getElementById('food').textContent   = state.food;
    }

    //–– 2) Open WebSocket
    const socket = new WebSocket(
      'wss://kr3dp8jyic.execute-api.us-east-1.amazonaws.com/production'
    );
    socket.onopen = () => {
      // allow voting once connected
      restBtn.disabled = huntBtn.disabled = false;
    };
    socket.onerror = e => console.error('WS error', e);

    //–– 3) Handle broadcasted roundResult
    socket.onmessage = ev => {
      const msg = JSON.parse(ev.data);
      if (msg.action === 'roundResult') {
        applyRoundResult(msg.result);
      }
    };

    function applyRoundResult(resultText) {
      roundResult.textContent = resultText;

      // apply mechanical effects
      if (resultText.includes('rests')) {
        state.health = Math.min(100, state.health + 5);
        state.food  -= 5;
      } else if (resultText.includes('hunts')) {
        if (Math.random() < 0.5) state.food += 20;
        else                  state.health -= 10;
        state.food -= 10;
      } else {
        // tie → coin flip
        if (Math.random() < 0.5) state.food  += 15;
        else                    state.health -= 5;
        state.food -= 10;
      }

      state.day++;
      updateStatusUI();

      // disable buttons until next round
      restBtn.disabled = huntBtn.disabled = true;

      // clear result & re-enable after 3s
      setTimeout(() => {
        roundResult.textContent = '';
        restBtn.disabled = huntBtn.disabled = false;
      }, 3000);
    }

    //–– 4) Send votes
    const restBtn   = document.getElementById('restBtn');
    const huntBtn   = document.getElementById('huntBtn');
    const roundResult = document.getElementById('roundResult');

    function sendVote(vote) {
      socket.send(JSON.stringify({ action:'sendVote', vote }));
      // immediately disable to prevent double‑voting
      restBtn.disabled = huntBtn.disabled = true;
    }

    restBtn.addEventListener('click', () => sendVote('rest'));
    huntBtn.addEventListener('click', () => sendVote('hunt'));

    // initialize
    updateStatusUI();
  </script>
</body>
</html>
